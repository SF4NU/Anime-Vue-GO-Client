import{_ as oe,r as l,A as ne,o as a,c as s,d as t,F as ie,e as ue,x as re,k as V,t as d,g as n,u as I,s as Q,h as $,v as ce,i as R,n as de,p as ve,l as pe}from"./index-CmE2cy4c.js";import{c as Z,a as S,_ as _e,b as q,d as G,e as he,f as me}from"./cross-circle-svgrepo-com-BAm_C_UQ.js";import{t as D}from"./timeout-CKcjILrp.js";const v=F=>(ve("data-v-30bfea8c"),F=F(),pe(),F),ge=v(()=>t("h1",null,"Manga List",-1)),fe={class:"anime-container"},ke={key:0,class:"anime-card-wrap"},ye={key:0},Ce={class:"completed-div"},we=v(()=>t("span",null,"Finito: ",-1)),xe=["src"],be={class:"dates-div"},Me={key:0},Ie=v(()=>t("br",null,null,-1)),De={key:1},Fe={key:1,class:"plan-to-watch-div"},Le=v(()=>t("span",null," Da leggere ?",-1)),Ve=["src"],$e={key:2,class:"comment-div"},Ue=["data-comment"],ze=v(()=>t("img",{height:"25px",src:me,alt:""},null,-1)),Be={key:0,class:"show-comment"},Ne={class:"edit-div"},Re=["onClick"],Se={key:1,class:"edit-div-wrapper"},Te={key:0,class:"edit-div"},Ae=["onClick","src"],je={class:"title-div"},Ee={key:1,class:"check-if-plan-to-watch"},Qe={class:"checkbox-wrapper-58"},Ze={class:"switch"},qe=v(()=>t("span",{class:"slider"},null,-1)),Ge=v(()=>t("h4",null,"Manga da leggere",-1)),He={key:2,class:"add-values-div"},Je=v(()=>t("div",{class:"episodes-title-div"},[t("h4",null,"Capitoli letti")],-1)),Ke={class:"add-episodes-div"},Oe={key:3,class:"add-values-div"},Pe=v(()=>t("div",{class:"rating-title-div"},[t("h4",null,"Voto")],-1)),We={class:"rating-div"},Xe={key:4,class:"edit-comment-div"},Ye={class:"text-area-div"},et={key:1},tt={key:5,class:"date-div"},at=v(()=>t("h5",null,"Data di inizio (opz.)",-1)),st={key:0},lt={key:6,class:"submit-anime-div"},ot={key:7,class:"remove-anime-div","data-remove":"Rimuovi dalla lista"},nt={key:8,class:"wrap-loader-error"},it=v(()=>t("div",{class:"loader"},null,-1)),ut={class:"error-response-div"},rt={__name:"MyMangaList",setup(F){const H=re(),J=l(H.params.userId),T=l(!1),p=l(null),K=l(!1),h=l(null),u=l(0),_=l(1),g=l(!1),k=l(""),y=l(""),f=l(!1),U=l(null),r=l(!1),L=l(!1),C=l(""),z=l(0);l(""),l(""),l([]);const O=l(""),m=l(""),w=l(null),B=()=>{u.value=0,_.value=1,g.value=!1,k.value="",y.value="",f.value=!1,C.value=""},P=()=>{L.value=!L.value},W=()=>{z.value=C.value.length},A=e=>e.split("-").reverse().join("-"),j=async(e,i)=>{if(h.value===e){h.value=null,B();return}h.value=e,B(),U.value=p.value[e].ID,u.value=p.value[e].chapters,_.value=p.value[e].rating,C.value=p.value[e].comment,z.value=p.value[e].comment.length,k.value=A(p.value[e].starting_date),y.value=A(p.value[e].ending_date),f.value=p.value[e].plan_to_read,r.value=!0,await le(i),x(w.value.attributes.chapterCount),r.value=!1},x=e=>{if(u.value>e-1||u.value==="Finito"){g.value=!0,u.value!=="Finito"&&(u.value="Finito"),w.value.attributes.chapterCount===1&&(u.value=1);return}g.value=!1},X=e=>{if(u.value>=e-1||u.value==="Finito"){u.value="Finito",x(e);return}x(e),u.value++},Y=e=>{if(u.value<=0){u.value=0,x(e);return}if(u.value==="Finito"){u.value=e-1,x(e);return}u.value--,x(e)},ee=()=>{if(_.value>=10){_.value=10;return}_.value+=.5},te=()=>{if(_.value<=1){_.value=1;return}_.value-=.5},M=()=>{h.value=null,r.value=!1,m.value=null},N=async()=>{try{const e=await V.get(`https://anime-vue-go-client-production.up.railway.app/users/${J.value}/manga`,{withCredentials:!0});e.status>=200&&e.status<=209&&(p.value=e.data.sort((i,o)=>i.title.localeCompare(o.title)),h.value=null,r.value=!1)}catch(e){console.error(e)}},E=e=>e.split("-").reverse().join("-"),ae=async()=>{try{r.value=!0;const e=await V.put(`https://anime-vue-go-client-production.up.railway.app/update/manga/${U.value}`,{chapters:u.value==="Finito"?w.value.attributes.chapterCount:u.value,rating:_.value,finished:g.value,starting_date:k.value!==""?E(k.value):"",ending_date:y.value!==""&&g.value?E(y.value):"",plan_to_read:f.value,comment:C.value},{withCredentials:!0});e.status>=200&&e.status<=209&&(m.value="Modificato!",await D(2e3),N(),M())}catch(e){console.error(e),e.response.status===400?(m.value="Errore, riprova più tardi",await D(2500),M()):(m.value="C'è stato un errore, non si sa perché!",await D(3e3),M())}},se=async()=>{try{r.value=!0;const e=await V.delete(`https://anime-vue-go-client-production.up.railway.app/delete/manga/${U.value}`,{withCredentials:!0});e.status>=200&&e.status<=209&&N()}catch(e){console.error(e),e.response.status===400?(m.value="Errore, riprova più tardi",await D(2500),M()):(m.value="C'è stato un errore, non si sa perché!",await D(3e3),M())}};ne(()=>{T.value||(T.value=!0,N())});const le=async e=>{try{const i=await V.get(`https://kitsu.io/api/edge/manga?filter[id]=${e}&page[limit]=1`);w.value=i.data.data[0]}catch(i){console.error(i)}};return(e,i)=>(a(),s("section",null,[ge,t("div",fe,[(a(!0),s(ie,null,ue(p.value,(o,b)=>(a(),s("div",{key:b,class:"anime-card"},[h.value!==b&&o.title!==O.value?(a(),s("div",ke,[t("h2",null,d(o.title),1),t("div",null,[t("span",null," Capitoli letti: "+d(o.chapters),1)]),o.plan_to_read?n("",!0):(a(),s("div",ye,[t("span",null," Voto assegnato: "+d(o.rating),1)])),t("div",Ce,[we,t("img",{height:"20px",src:o.finished?I(Z):I(S),alt:""},null,8,xe)]),t("div",be,[o.starting_date!==""?(a(),s("span",Me," Inizio: "+d(o.starting_date),1)):n("",!0),Ie,!o.plan_to_watch&&o.finished?(a(),s("span",De," Fine: "+d(o.ending_date),1)):n("",!0)]),!o.finished&&o.plan_to_watch?(a(),s("div",Fe,[Le,Q("  "),t("img",{height:"20px",src:o.plan_to_watch?I(Z):I(S),alt:""},null,8,Ve)])):n("",!0),o.comment!==""?(a(),s("div",$e,[t("button",{class:"comment-button","data-comment":o.comment},[Q(" Nota   "),ze],8,Ue),K.value?(a(),s("p",Be,d(o.comment),1)):n("",!0)])):n("",!0),t("div",Ne,[t("img",{onClick:c=>j(b,o.manga_id),height:"25px",src:_e,alt:""},null,8,Re)])])):n("",!0),h.value===b?(a(),s("div",Se,[r.value?n("",!0):(a(),s("div",Te,[t("img",{onClick:c=>j(b),height:"25px",src:I(S),alt:"cross-icon"},null,8,Ae)])),t("div",je,[t("h2",null,d(o.title),1)]),r.value?n("",!0):(a(),s("div",Ee,[t("div",Qe,[t("label",Ze,[$(t("input",{onClick:B,type:"checkbox","onUpdate:modelValue":i[0]||(i[0]=c=>f.value=c)},null,512),[[ce,f.value]]),qe])]),Ge])),!f.value&&!r.value?(a(),s("div",He,[Je,t("div",Ke,[t("img",{height:"30px",src:q,onClick:i[1]||(i[1]=c=>Y(w.value.attributes.chapterCount)),alt:"minus-svg"}),t("span",null,d(u.value),1),t("img",{height:"25px",src:G,onClick:i[2]||(i[2]=c=>X(w.value.attributes.chapterCount)),alt:"plus-svg"})])])):n("",!0),!f.value&&!r.value?(a(),s("div",Oe,[Pe,t("div",We,[t("img",{height:"30px",src:q,onClick:te,alt:"minus-svg"}),t("span",null,d(_.value),1),t("img",{height:"25px",src:G,onClick:ee,alt:"plus-svg"})])])):n("",!0),r.value?n("",!0):(a(),s("div",Xe,[t("button",{onClick:P},"Nota"),t("div",Ye,[L.value?$((a(),s("textarea",{key:0,onInput:W,maxlength:"200","onUpdate:modelValue":i[3]||(i[3]=c=>C.value=c),name:"comment",id:"comment",cols:"20",rows:"5",placeholder:"Questo anime mi è piaciuto/non mi è piaciuto perché..."},`\r
              `,544)),[[R,C.value]]):n("",!0),L.value?(a(),s("span",et,d(z.value)+"/200",1)):n("",!0)])])),r.value?n("",!0):(a(),s("div",tt,[at,$(t("input",{type:"date","onUpdate:modelValue":i[4]||(i[4]=c=>k.value=c),min:"2000-01-01",max:"2025-12-31"},null,512),[[R,k.value]]),g.value?(a(),s("h5",st,"Data di fine (opz.)")):n("",!0),g.value?$((a(),s("input",{key:1,type:"date","onUpdate:modelValue":i[5]||(i[5]=c=>y.value=c),min:"2000-01-01",max:"2025-12-31"},null,512)),[[R,y.value]]):n("",!0)])),r.value?n("",!0):(a(),s("div",lt,[t("button",{onClick:ae},"Modifica")])),r.value?n("",!0):(a(),s("div",ot,[t("img",{onClick:se,height:"30px",src:he,alt:""})])),r.value&&h.value===b?(a(),s("div",nt,[it,t("div",ut,[t("span",{class:de(m.value==="Modificato!"?"error-blue":"")},d(m.value),3)])])):n("",!0)])):n("",!0)]))),128))])]))}},pt=oe(rt,[["__scopeId","data-v-30bfea8c"]]);export{pt as default};
